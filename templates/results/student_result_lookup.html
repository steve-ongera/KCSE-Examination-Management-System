<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KNEC Student Results Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .result-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
        }
        .form-card {
            background-color: #f1f3f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .result-card {
            border-left: 4px solid #5f6c72;
            background-color: #f8f9fa;
        }
        .knec-primary {
            color: #5f6c72;
        }
        .btn-knec {
            background-color: #5f6c72;
            color: white;
        }
        .btn-knec:hover {
            background-color: #4a565c;
            color: white;
        }
        .student-name {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .result-badge {
            font-size: 1.2rem;
            padding: 0.5rem 1rem;
        }
    </style>
</head>
<body>
    <div class="result-container">
        <div class="text-center mb-4">
            <img src="https://via.placeholder.com/150x50?text=KNEC+Logo" alt="KNEC Logo" class="mb-3">
            <h2 class="knec-primary">Student Results Portal</h2>
            <p class="text-muted">Enter your details to view your examination results</p>
        </div>

        <div class="form-card">
            <form method="POST">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="first_name" class="form-label">First Name</label>
                        <input type="text" class="form-control" id="first_name" name="first_name" required>
                    </div>
                    <div class="col-md-4">
                        <label for="middle_name" class="form-label">Middle Name (if any)</label>
                        <input type="text" class="form-control" id="middle_name" name="middle_name">
                    </div>
                    <div class="col-md-4">
                        <label for="last_name" class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="last_name" name="last_name" required>
                    </div>
                    <div class="col-md-6">
                        <label for="index_number" class="form-label">Index Number</label>
                        <input type="text" class="form-control" id="index_number" name="index_number" required>
                    </div>
                    <div class="col-md-12 mt-3">
                        <button type="submit" class="btn btn-knec">
                            <i class="bi bi-search me-2"></i>Search Results
                        </button>
                    </div>
                </div>
            </form>
        </div>

        {% if error %}
        <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ error }}
        </div>
        {% endif %}

        {% if result %}
        <div class="result-card p-4 mb-4">
            <div class="row">
                <div class="col-md-8">
                    <div class="student-name">
                        {{ result.student.first_name }}
                        {% if result.student.middle_name %} {{ result.student.middle_name }} {% endif %}
                        {{ result.student.last_name }}
                    </div>
                    <div class="text-muted mb-2">
                        <i class="bi bi-person-badge me-2"></i>{{ result.student.index_number }}
                    </div>
                    <div>
                        <i class="bi bi-building me-2"></i>{{ result.student.school.name }}
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="text-muted">Exam Year</div>
                    <div class="h4">{{ result.year }}</div>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>Subject</th>
                        <th class="text-end">Grade</th>
                        <th class="text-end">Points</th>
                    </tr>
                </thead>
                <tbody>
                    {% for subject in result.subjects.all %}
                    <tr>
                        <td>{{ subject.name }}</td>
                        <td class="text-end">{{ subject.grade }}</td>
                        <td class="text-end">{{ subject.points }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-light">
                    <tr>
                        <th>Total</th>
                        <th class="text-end">{{ result.mean_grade }}</th>
                        <th class="text-end">{{ result.total_points }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <div>
                <button class="btn btn-outline-secondary" onclick="window.print()">
                    <i class="bi bi-printer me-2"></i>Print Results
                </button>
            </div>
            <div class="text-muted small">
                Result retrieved on {% now "jS F Y H:i" %}
            </div>
        </div>
        {% endif %}

        <div class="mt-5 pt-4 border-top text-center text-muted small">
            <p>Kenya National Examinations Council &copy; {% now "Y" %}</p>
            <p>For any discrepancies, contact your school administration or KNEC support.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>